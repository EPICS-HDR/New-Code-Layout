{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Data Page</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="{% static 'styles.css' %}" />
  </head>
  <body>
    {% include 'sources/header.html' %}
     <!-- {% include 'sources/fields.html' %} -->

    <div class="container">

      <form action="/sources/selected-review/" method="get" class="w-100">
        <div class="my-3 w-100">
          {{ form.as_p }}
        </div>
        <!-- <div class="my-3 w-100">
          <div class="d-flex w-100 m-auto gap-2 align-items-center">
            *Download
            <select
              name="selected-files"
              class="form-select form-select-sm"
              style="width: 200px"
            >
              <option>selected files</option>
            </select>
            as
            <select
              name="file-type"
              class="form-select form-select-sm"
              style="width: 200px"
            >
              <option>json</option>
              <option>csv</option>
              <option>pdf</option>
            </select>
          </div>
        </div>

        <div class="my-3 w-100">
          <div class="d-flex w-100 m-auto gap-2 align-items-center">
            Search:
            <input
              placeholder="Enter search keyword"
              class="form-control w-25 form-control-sm me-3"
            />
            <button class="btn btn-primary btn-sm">Select All</button>
            <button class="btn btn-primary btn-sm">Clear All</button>
          </div>
        </div> -->

        <table class="table table-bordered table-hover table-light">
          <thead class="thead-dark">
            <tr>
              {% for it in colunms %}
              <th>{{ it }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody id="tableBody">
            {% for row in table %}
            <tr>
              {% for cell in row %}
              <td>{{ cell }}</td>
              {% endfor %}
            </tr>
            {% endfor %}

            {% if not table %}
            <tr>
               <td colspan="4" class="text-center">
                   No data available in table
               </td>
            </tr>
            {% endif %}
          </tbody>
        </table>
        <div class="w-100 d-flex justify-content-end">
          <nav aria-label="Page navigation example">
            <ul class="pagination">
                {% if table.has_previous %}
                    <li class="page-item"><a class="page-link" href="?page=1">First</a></li>
                    <li class="page-item"><a class="page-link" href="?page={{ table.previous_page_number }}">Previous</a></li>
                {% endif %}

                {% for i in table.paginator.page_range %}
                    {% if table.number == i %}
                        <li class="page-item active"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                    {% elif i > table.number and i <= table.number|add:5 %}
                        <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                    {% elif i < table.number and i >= table.number|add:-4 %}
                        <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                    {% endif %}
                {% endfor %}

                {% if table.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ table.next_page_number }}">Next</a></li>
                    <li class="page-item"><a class="page-link" href="?page={{ table.paginator.num_pages }}">Last</a></li>
                {% endif %}
            </ul>
          </nav>
        </div>

        <div class="text-center">
            <button type="submit" class="btn btn-primary btn-sm my-3 m-auto">Preview to download</button>
        </div>

      </form>
    </div>

    <!-- {% include 'sources/missing.html' %} -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const downloadButton = document.querySelector("#download-btn"); // Assuming your download button has an ID or you can select it with some other selector
        downloadButton.addEventListener("click", function () {
          const selectedFiles = document.querySelector(
            'select[name="selected-files"]'
          ).value;
          const fileType = document.querySelector(
            'select[name="file-type"]'
          ).value;

          // Build request URL
          const url = `/download?fileType=${fileType}&files=${selectedFiles}`;
          window.location.href = url; // Navigate to the URL to download the file
        });
      });
    </script>

    <style>
      #id_my_field > div {
        display: inline;
      }
    </style>
  </body>
</html>
